@model Site.Models.AllFilesViewModel

@{
    ViewData["Title"] = "AllFiles";
}

<div class="container">

    <h4>File Repository</h4>
    <p>
        <a class="btn btn-primary" data-toggle="collapse" href="#imageDiv" role="button" aria-expanded="false" aria-controls="imageDiv">Images</a>
    </p>
    
    <div class="container collapse" id="imageDiv">
        @foreach (FileCategories category in Model.Categories)
        {
            <div class="row">
                <div class="col">
                    <p class="pt-3">
                        <a class="btn btn-secondary" data-toggle="collapse" href="#@category.CategoryLabel.Replace(" ", "")" role="button" aria-expanded="false" aria-controls="@category.CategoryId">
                            @category.CategoryLabel (@Model.Images.Where(i => i.CategoryId == category.CategoryId).Count())
                        </a>
                    </p>
                </div>
                <div class="col collapse" id="@category.CategoryLabel.Replace(" ", "")">
                    <form asp-controller="Image" asp-action="Upload" enctype="multipart/form-data" method="post">
                        <div class="row">
                            <div class="col">
                                <input type="file" multiple name="files" id="uploadInput" />
                                <label id="uploadInputLabel" class="custom-file-label" for="uploadInput">Choose file(s)</label>
                            </div>
                            <div class="col">
                                <input type="submit" class="btn btn-primary" value="Upload" />
                                <input type="hidden" name="categoryId" value="@category.CategoryId" />
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <div class="container collapse pb-3" id="@category.CategoryLabel.Replace(" ", "")">
                @foreach (Images img in Model.Images.Where<Images>(i => i.CategoryId == category.CategoryId).ToList())
                {
                    if (Model.Images.Where<Images>(i => i.CategoryId == category.CategoryId).Count<Images>() < 1)
                    {
                        <div class="row">
                            <p>Nothing found in this category!</p>
                        </div>
                    }
                    else
                    {
                        <div class="row pt-3">
                            <div class="col-lg-6 col-md-4 col-sm-2">
                                <img src="~/Images/@category.CategoryLabel/@img.ImgFileName" alt="@img.ImgFileName" style="max-width:100%; height:auto" />
                                <p class="pt-1">Uploaded: @img.UploadedDate.ToString("yyyy'-'MM'-'dd")</p>
                                    <a class="pr-2" asp-action="Delete" asp-controller="Image" asp-route-id="@img.ImageId">Delete</a>
                                    @if (img.IsPublished == 1)
                                    {
                                        <a class="pr-2" asp-action="Unpublish" asp-controller="Image" asp-route-id="@img.ImageId">Unpublish</a>
                                    }
                                    else
                                    {
                                        <a class="pr-2" asp-action="Publish" asp-controller="Image" asp-route-id="@img.ImageId">Publish</a>
                                    }
                                    <button class="btn btn-secondary btn-outline-dark dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        @Model.Categories.First(c => c.CategoryId == img.CategoryId).CategoryLabel
                                    </button>
                                    <div class="dropdown-menu">
                                        @foreach(FileCategories _category in Model.Categories)
                                        {
                                            <a class="dropdown-item btn btn-secondary btn-outline-dark" asp-controller="Image" asp-action="CategoryUpdate" asp-route-ImgId="@img.ImageId" asp-route-CatId="@_category.CategoryId">@_category.CategoryLabel</a>
                                        }
                                    </div>
                            </div>
                        </div>
                    }
                }
            </div>
            <hr/>
        }
    </div>

    <p class="pt-3">
        <a class="btn btn-primary" data-toggle="collapse" href="#fileDiv" role="button" aria-expanded="false" aria-controls="fileDiv">Files</a>
    </p>
    <div class="container collapse" id="fileDiv">
        <div class="col collapse" id="fileDiv">
            <form asp-controller="File" asp-action="NewFolder" method="post">
                <div class="row">
                    <div class="col">
                        <input type="text" name="folderName"/>
                        <label for="folderName">New folder...</label>
                    </div>
                    <div class="col">
                        <input type="submit" class="btn btn-primary" value="Upload" />
                    </div>
                </div>
            </form>
        </div>
        @if (Model.Files.Count<Files>() == 0)
        {
            <div class="row">
                <p>No files available!</p>
            </div>
        }
        else
        {
            List<string> DistinctFolders = Model.Files.Select(f => f.FolderName).Distinct().ToList();
            foreach (string folder in DistinctFolders)
            {
            <div class="row">
                <div class="col">
                    <p class="pt-3">
                        <a class="btn btn-secondary" data-toggle="collapse" href="#@folder.Replace(" ", "")" role="button" aria-expanded="false" aria-controls="@folder.Replace(" ", "")">
                            @folder
                        </a>
                    </p>
                </div>
                <div class="col collapse" id="@folder.Replace(" ", "")">
                    
                </div>
            </div>
            }
        }
    </div>

    <div class="pt-3">
        <a class="btn btn-primary" asp-action="Index" asp-controller="Image">Back to submit</a>
    </div>
</div>